<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png"><link rel="icon" href="/img/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="description" content="My own blog."><meta name="author" content="yrPang"><meta name="keywords" content=""><title>Git Review Memo - yrPang</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/tomorrow-night.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"blog.yrpang.com",root:"/",version:"1.8.11",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:null,google:"UA-131692412-1",gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"PpDjpxNOCKXQAVpsHUkFA7HH-MdYXbMMI",app_key:"DG0A9hOcBbRJAcVK78aJLY1L",server_url:null},tajs:null},search_path:"/local-search.xml"}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="yrPang" type="application/atom+xml"></head><body><header style="height:100vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>yrPang</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/atom.xml"><i class="iconfont icon-rss-fill"></i> RSS</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://myblog-1254913510.file.myqcloud.com/cffn9.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="Git Review Memo"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-03-21 14:00" pubdate>2021年3月21日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 23 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div><div class="scroll-down-bar"><i class="iconfont icon-arrowdown"></i></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">Git Review Memo</h1><p class="note note-info">本文最后更新于：几秒前</p><div class="markdown-body"><p>本文为<a href="https://git-scm.com/book/zh/v2">Pro Git</a>阅读笔记，整理了日常操作中涉及到的git操作。</p><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><ol><li><p><code>git xxx -h</code> 可以查看该命令参数的简要介绍</p><ul><li><code>git help xxx</code>可以查看详细文档</li></ul></li><li><p>命令中<code>--</code>用来区分参数和文件路径(e.g. <code>git checkout -- &lt;file&gt;</code>)</p></li></ol><h2 id="撤销更改"><a href="#撤销更改" class="headerlink" title="撤销更改"></a>撤销更改</h2><ul><li><p><code>git commit --amend [--no-edit]</code> 将内容增加进上次的更改[保持提交信息不变]</p></li><li><p><code>git restore --staged &lt;file&gt;</code> <code>git reset HEAD &lt;file&gt;</code> 撤销文件暂存</p></li><li><p><code>git restore &lt;file&gt;</code> <code>git checkout -- &lt;file&gt;</code> 撤销文件的编辑(<strong><em>不可恢复</em></strong>)</p></li><li><p><code>git revert</code> 创建一个新的commit来撤销指定的commit</p></li><li><p>撤销合并见<a href="#撤销合并">下文</a></p></li></ul><h2 id="分支操作"><a href="#分支操作" class="headerlink" title="分支操作"></a>分支操作</h2><blockquote><p>git内部是一个单向列表，每个节点的指针都指向前一个节点。<br>每个 branch 都是一个指针, HEAD 也是一个指针只想当前 checkout 出来的位置<br>这非常重要! 理解这一点就能理解下面的一切了</p></blockquote><ul><li><p>use <code>git switch</code> to switch</p></li><li><p><code>git branch [--merged | --no-merged] [&lt;name&gt;]</code> 显示已经合并(或没有合并)进当前分支(或name分支)的分支</p></li><li><code>git branch &lt;name&gt; [&lt;hash&gt;]</code> 从当前状态[使用指定hash]创建分支</li><li><p><code>git branch -d &lt;name&gt;</code> 删除指定分支(-D强制删除)</p></li><li><p><code>git checkout -b &lt;name&gt; [&lt;hash&gt;]</code> 创建并切换分支</p></li></ul><h3 id="关于合并分支与分叉"><a href="#关于合并分支与分叉" class="headerlink" title="关于合并分支与分叉"></a>关于合并分支与分叉</h3><ol><li>当两个分支都进行了各自的更改并commit后才会有所谓分叉现象，会使用 <em>3-way merge策略</em> 进行合并</li><li>如果只是一个分支有更改而另一个分支没有，则合并使用简单的 <em>fast-forward</em> 策略合并即可</li></ol><p><strong>fast-forward</strong> 当试图合并两个分支时，如果顺着一个分支走下去能够到达另一个分支，那么Git只会简单的将指针向前推进（指针右移）</p><h3 id="遇到冲突的情况"><a href="#遇到冲突的情况" class="headerlink" title="遇到冲突的情况"></a>遇到冲突的情况</h3><ol><li><code>======</code>符号的上半部分为<code>HEAD</code>所指的文件状态，也就是当前检出的分支的文件状态，下半部分为传入的更改</li><li>在处理好冲突后，使用<code>git add</code>将其标记为处理完成</li><li><code>git mergetool</code>可以启动图形化界面帮助处理更改</li><li>全部处理完成后使用<code>git commit</code>来进行提交</li></ol><h3 id="Merge-rebase-and-squaze"><a href="#Merge-rebase-and-squaze" class="headerlink" title="Merge, rebase and squaze"></a>Merge, rebase and squaze</h3><h4 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h4><p>merge会将待合并分支的信息全部带入到合并结果中。</p><p>问题：如果一个节点有两个前向节点怎么存储？</p><h3 id="remote-branch"><a href="#remote-branch" class="headerlink" title="remote-branch"></a>remote-branch</h3><ol><li><code>git fetch</code> 可以将服务器的数据拉取到本地来，但是并不修改本地的分支</li><li><code>git branch -vv</code> 可以查看分支追踪情况</li><li><p><code>git ls-remote</code> 显示远程情况</p></li><li><p><code>git checkout -b &lt;name&gt; &lt;remote/name&gt;</code>可以从一个远程分支创建本地分支来开始工作，这会自动创建所谓追踪分支</p></li><li><p><code>git push --set-upstream-to &lt;local_bantch_name&gt;[:&lt;remote_bantch_name&gt;]</code>可以将本地存在而远程不存在的分支推送到远程去，同样自动追踪</p><ul><li>这等价于下面两步操作</li><li>step1 <code>git push &lt;origin&gt; &lt;local_bantch_name&gt;[:&lt;remote_bantch_name&gt;]</code> 将本地的某个分支推送到远程</li><li>step2 <code>git branch [-u | --set-upstream-to] &lt;origin/xxx&gt;</code>将本地的追踪分支设定为远程的xxx</li></ul></li><li><p><code>git push origin --delete xxx</code>可以删除远程分支xxx</p><ul><li><code>git push origin :&lt;NAME&gt;</code> 效果同样</li></ul></li></ol><h4 id="关于追踪分支"><a href="#关于追踪分支" class="headerlink" title="关于追踪分支"></a>关于追踪分支</h4><ol><li><code>git checkout --track origin/serverfix</code> 也可以从远程创建追踪分支</li><li><code>git checkout serverfix</code>当本地不存在远程存在时，这样子会自动按照上一条执行</li><li><code>git checkout -b &lt;name&gt; &lt;remote/name&gt;</code> 可以创建和远程名称不同的本地分支</li></ol><h2 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h2><p>Rebase 是把相对于共同祖先节点的操作整理出来依次应用到目标分支，以此来达到消除分叉的目的。</p><p>Rebase后只是checkout到目标分支进行<code>fast-forward merge</code></p><p><img src="https://git-scm.com/book/en/v2/images/basic-rebase-1.png" srcset="/img/loading.gif" lazyload><br><img src="https://git-scm.com/book/en/v2/images/basic-rebase-3.png" srcset="/img/loading.gif" lazyload></p><ol><li><p><code>git rebase &lt;target_branch&gt;</code>把当前分支应用到 target_branch 上</p></li><li><p><code>git rebase --onto master server client</code> 将在<code>client</code>分支里但不在<code>server</code>分支里的修改后合并到<code>master</code>上</p></li><li><p><code>git rebase &lt;basebranch&gt; &lt;topicbranch&gt;</code> 把topic整合到base上</p></li></ol><p><em>技巧</em> 如果本地和远程都有修改可以直接<code>rebase</code>本地到<code>remotes/origin/HEAD</code></p><h2 id="选择或指定commit"><a href="#选择或指定commit" class="headerlink" title="选择或指定commit"></a>选择或指定commit</h2><ol><li><p><code>git show &lt;hash&gt;</code> 用来查看指定提交</p></li><li><p><code>HEAD@&#123;n&#125;</code> HEAD第n次移动前的位置(当前为0)</p><ul><li><code>git reflog</code>可以查看历史记录</li><li>同理<code>main@&#123;3&#125;</code>可以查看main3次移动前的位置</li><li>引用日志只保存在本地</li></ul></li><li><p><code>HEAD^[n]</code> 代表HEAD的第n个父提交(不写n代表1) 用于选择在合并分叉的时候造成的多个父亲</p></li><li><p><code>HEAD~[n]</code> 节点[的父亲]*n 用来选择祖父节点</p></li><li><p><code>git log master..topic</code> topic分支中有但是master分支中没有的提交</p><ul><li><code>git diff master..topic</code> 查看两个分支的差别</li></ul></li><li><code>git log refA refB ^refC</code> refA和refB中有但是refC中没有的提交</li><li><code>git log [--left-right] master...experiment</code> 被两者之一包含但是不被同时包含的提交[显示究竟被哪个包含]</li></ol><h2 id="交互式操作"><a href="#交互式操作" class="headerlink" title="交互式操作"></a>交互式操作</h2><ol><li><code>git add -i</code> 进入交互式暂存模式，可以把文件的一部分更改add进去</li></ol><p>类似的还有下面几个(-p —patch)：</p><ol><li><code>git add -p</code></li><li><code>git stash -p</code></li><li><code>git restore -S -p</code> 交互式取消stage</li><li><code>git restore [-s] -p</code> 交互式discard(取消更改)</li></ol><h2 id="修改提交历史"><a href="#修改提交历史" class="headerlink" title="修改提交历史"></a>修改提交历史</h2><ol><li><code>git rebase -i HEAD~3</code> 交互式的rebase即可完成修改 <strong>这个操作可以对历史进行各种修改(合并、删除等等)</strong></li></ol><h2 id="关于reset和checkout"><a href="#关于reset和checkout" class="headerlink" title="关于reset和checkout"></a>关于reset和checkout</h2><p><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E7%BD%AE%E6%8F%AD%E5%AF%86">文档链接</a></p><p><img src="https://git-scm.com/book/en/v2/images/reset-workflow.png" srcset="/img/loading.gif" lazyload></p><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ol><li><p>文档中所说的<code>Index</code>是指暂存区(看图理解)</p><ul><li>Git将上一次检出到工作目录中的所有文件填充到索引区</li><li>之后你会修改并使用<code>git add</code>将其中一些文件替换为新版本</li><li>接着通过 git commit 将它们转换为树来用作新的提交</li></ul></li><li><p><code>Working Tree</code>就是指工作目录</p></li></ol><h3 id="reset和checkout的区别"><a href="#reset和checkout的区别" class="headerlink" title="reset和checkout的区别"></a>reset和checkout的区别</h3><p><code>git checkout</code>是在移动<em>HEAD自己</em>，而<code>reset</code>是移动<em>HEAD所指向分支</em>的指向</p><h3 id="两者的使用"><a href="#两者的使用" class="headerlink" title="两者的使用"></a>两者的使用</h3><ol><li><p>commit级别</p><ul><li><code>--soft</code> 只改变<code>HEAD</code>，不改变<code>Index</code>和<code>Working Tree</code>。本质上是撤销<code>git commit</code>。这样进行<code>commit</code>相当于在进行<code>git commit -amend</code></li><li><code>--mixed</code> 改变<code>HEAD</code>和<code>Index</code>，不改变<code>Working Tree</code>。相当于在上面的基础上再进行<code>git restore -S</code></li><li><code>--hard</code> 全都改变。相当于在上谜案的基础上再进行<code>git restore -s</code>(<strong>危险</strong>)</li></ul></li><li><p>操作单个文件</p><ul><li><code>git reset [commit] &lt;paths&gt;</code> 使某个文件在<code>Index</code>中的状态变到指定版本</li><li><code>git checkout [commit] &lt;paths&gt;</code>使某个文件在<code>Working Tree</code>中的状态变到指定版本(<strong>危险</strong>)</li></ul></li></ol><h3 id="撤销合并"><a href="#撤销合并" class="headerlink" title="撤销合并"></a>撤销合并</h3><ol><li><p><code>git reset --hard HEAD~</code> 但是这会修改历史，如果已经发布更改最好不这样做</p></li><li><p><code>git revert -m 1 HEAD</code> -m指出回到哪个父节点，对于合并来说1就是刚刚合并来的那个节点</p></li></ol><h3 id="不甚严谨的几点理解"><a href="#不甚严谨的几点理解" class="headerlink" title="不甚严谨的几点理解"></a>不甚严谨的几点理解</h3><p>git主要包括节点和指针，数据和文件目录会以节点的形式存储起来，而<code>branch</code>, <code>HEAD</code>等均为指向节点的指针。</p><ul><li><code>commit</code>和<code>add</code>操作是在创建节点，其他操作几乎都是在移动指针</li><li><code>git push</code>是在移动仓库的指针<code>remotes/origin/HEAD</code>等等</li><li><code>git pull</code>是在依据设定的”追踪分支”尝试merge远程更改并移动<code>HEAD</code>指针及分支指针</li><li><code>git fetch</code>的时候会把远程仓库的数据都拿下来但是并不更改本地的指针指向，手动进行<code>merge remotes/origin/HEAD</code>操作后就相当于执行了<code>git pull</code></li><li><code>git merge rebase等</code>是在比对文件并移动<code>HEAD</code>和HEAD所指向的branch的指针</li><li><code>reset</code>是在试图直接操作指针和Index区域，</li><li>在各种指针移动的时候对应的节点并不会被删除，只是因为链接为单向的，可能因为指针的移动变得无法找到，但是只要能找到那个节点hash就可以恢复(e.g. 使用<code>reflog</code>)。换句话说，理论上只要git已经为文件创建了blob文件，那么内容就不会丢失只是可能不容易找到。</li></ul><p><strong>参考资料:</strong></p><p>全文内容为<a href="https://git-scm.com/book/zh/v2">Pro Git</a>阅读笔记</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/git/">git</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"></article><article class="post-next col-6"><a href="/posts/6894/"><span class="hidden-mobile">创建Apple设备描述文件并签名</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><div id="valine"></div><script>Fluid.utils.loadComments("#valine",function(){Fluid.utils.createScript("https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js",function(){var a=Object.assign({appId:"PpDjpxNOCKXQAVpsHUkFA7HH-MdYXbMMI",appKey:"DG0A9hOcBbRJAcVK78aJLY1L",placeholder:"说点什么",path:"window.location.pathname",avatar:"retro",meta:["nick","mail","link"],pageSize:10,lang:"zh-CN",highlight:!1,recordIP:!0,serverURLs:null,emojiCDN:null,emojiMaps:null,enableQQ:!1,requiredFields:[],appid:"PpDjpxNOCKXQAVpsHUkFA7HH-MdYXbMMI",appkey:"DG0A9hOcBbRJAcVK78aJLY1L"},{el:"#valine",path:window.location.pathname});new Valine(a)})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><span>yrPang &copy; 2021</span><br>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a> Theme<div class="footer-content"></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script src="/js/local-search.js"></script><script defer src="/js/leancloud.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script><script>!function(t){(0,Fluid.plugins.typing)(t.getElementById("subtitle").title)}((window,document))</script><script defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-131692412-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script src="/js/boot.js"></script></body></html>